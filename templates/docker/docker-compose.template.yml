# ============================================================================
# sgiT ${PROJECT_NAME} - Docker Compose Template
# ============================================================================
#
# PROJEKT-NAME: sgit-${PROJECT_NAME_LOWER}
# Schema: sgit-%projectname% (z.B. sgit-education, sgit-wearpart, sgit-api)
#
# ANLEITUNG:
#   1. Kopiere diesen Ordner in dein neues Projekt
#   2. Ersetze ${PROJECT_NAME} mit deinem Projektnamen (z.B. "My App")
#   3. Ersetze ${PROJECT_NAME_LOWER} mit kleingeschrieben (z.B. "myapp")
#   4. Passe Ports an falls Konflikte (8080, 11434)
#   5. docker-compose up -d
#
# USAGE:
#   docker-compose up -d          # Starten
#   docker-compose down           # Stoppen
#   docker-compose logs -f        # Logs
#   docker-compose up -d --build  # Neu bauen
#
# @version 1.0
# @date 12.12.2025
# @author sgiT Solution Engineering & IT Services
# ============================================================================

# Projektname für Docker Desktop (statt Ordnername)
name: sgit-${PROJECT_NAME_LOWER}

services:
  # ==========================================================================
  # NGINX - Webserver & Reverse Proxy
  # ==========================================================================
  nginx:
    image: nginx:alpine
    container_name: sgit-${PROJECT_NAME_LOWER}-nginx
    ports:
      - "8080:80"          # http://localhost:8080
      # - "443:443"        # HTTPS (Production)
    volumes:
      - ../:/var/www/html:ro                           # App Code (read-only)
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro    # nginx Config
      - ./nginx/sites:/etc/nginx/conf.d:ro             # Site Configs
    depends_on:
      - php
    networks:
      - sgit-${PROJECT_NAME_LOWER}-network
    restart: unless-stopped

  # ==========================================================================
  # PHP-FPM - Application Server
  # ==========================================================================
  php:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sgit-${PROJECT_NAME_LOWER}-php
    volumes:
      - ../:/var/www/html                              # App Code (read-write)
      - ./php/php.ini:/usr/local/etc/php/php.ini:ro    # PHP Config
    environment:
      - APP_ENV=development
      - APP_DEBUG=true
      - OLLAMA_HOST=ollama
      - OLLAMA_PORT=11434
      - OLLAMA_MODEL=gemma2:2b
    networks:
      - sgit-${PROJECT_NAME_LOWER}-network
    restart: unless-stopped

  # ==========================================================================
  # OLLAMA - AI/LLM Server (Optional)
  # ==========================================================================
  # Entfernen oder auskommentieren wenn keine AI benötigt
  ollama:
    image: ollama/ollama:latest
    container_name: sgit-${PROJECT_NAME_LOWER}-ollama
    ports:
      - "11434:11434"
    volumes:
      - sgit-${PROJECT_NAME_LOWER}-ollama:/root/.ollama
    # GPU Support (NVIDIA) - auskommentieren wenn keine GPU
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]
    networks:
      - sgit-${PROJECT_NAME_LOWER}-network
    restart: unless-stopped

# ============================================================================
# NETWORKS
# ============================================================================
networks:
  sgit-${PROJECT_NAME_LOWER}-network:
    driver: bridge

# ============================================================================
# VOLUMES - Persistente Daten
# ============================================================================
volumes:
  sgit-${PROJECT_NAME_LOWER}-ollama:
    name: sgit-${PROJECT_NAME_LOWER}-ollama-models
