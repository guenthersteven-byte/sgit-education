# ============================================================================
# sgiT Education Platform - Docker Compose
# ============================================================================
#
# PROJEKT-NAME: sgit-education
# Schema: sgit-%projectname% (z.B. sgit-education, sgit-wearpart, sgit-api)
#
# Startet die komplette Entwicklungsumgebung:
# - nginx (Webserver)
# - PHP-FPM 8.3 (Application)
#
# USAGE:
#   docker-compose up -d          # Starten
#   docker-compose down           # Stoppen
#   docker-compose logs -f        # Logs
#   docker-compose up -d --build  # Neu bauen
#
# @version 1.2
# @date 12.12.2025
# ============================================================================

# Projektname fÃ¼r Docker Desktop (statt Ordnername "docker")
name: sgit-education

services:
  # ==========================================================================
  # NGINX - Webserver & Reverse Proxy
  # ==========================================================================
  nginx:
    image: nginx:alpine
    container_name: sgit-education-nginx
    ports:
      - "8080:80"          # http://localhost:8080
      # - "443:443"        # HTTPS (Production)
    volumes:
      - ../:/var/www/html:ro                           # App Code (read-only)
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro    # nginx Config
      - ./nginx/sites:/etc/nginx/conf.d:ro             # Site Configs
    depends_on:
      - php
    networks:
      - sgit-education-network
    restart: unless-stopped

  # ==========================================================================
  # PHP-FPM - Application Server
  # ==========================================================================
  php:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sgit-education-php
    volumes:
      - ../:/var/www/html                              # App Code (read-write)
      - ./php/php.ini:/usr/local/etc/php/php.ini:ro    # PHP Config
      # SQLite DBs direkt aus dem Projekt-Ordner (kein separates Volume)
      # Damit bleiben die bestehenden Daten erhalten!
      # OneDrive Backup-Verzeichnis (Windows -> Container)
      - /c/Users/SG/OneDrive/sgiT/sgiT/WebsiteSourcefiles_sgitspace/backups:/mnt/onedrive-backup
    environment:
      - APP_ENV=development
      - APP_DEBUG=true
    networks:
      - sgit-education-network
    restart: unless-stopped

# ============================================================================
# NETWORKS
# ============================================================================
networks:
  sgit-education-network:
    driver: bridge
